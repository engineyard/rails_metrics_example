/* g.Raphael 0.4 - Charting library, based on Raphaël
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT License.
 * This code was modified by José Valim to not include "Others" neither sort values.
 */
Raphael.fn.g.piechart=function(d,c,n,b,k){k=k||{};var j=this,l=[],f=this.set(),m=this.set(),h=this.set(),t=[],v=b.length,w=0,x=0;m.covers=f;if(v==1){h.push(this.circle(d,c,n).attr({fill:this.g.colors[0],stroke:opt.stroke||"#fff","stroke-width":k.strokewidth==null?1:k.strokewidth}));f.push(this.circle(d,c,n).attr(this.g.shim));x=b[0];b[0]={value:b[0],order:0,valueOf:function(){return this.value}};h[0].middle={x:d,y:c};h[0].mangle=180}else{function s(C,B,i,E,A,J){var G=Math.PI/180,y=C+i*Math.cos(-E*G),p=C+i*Math.cos(-A*G),D=C+i/2*Math.cos(-(E+(A-E)/2)*G),I=B+i*Math.sin(-E*G),H=B+i*Math.sin(-A*G),z=B+i/2*Math.sin(-(E+(A-E)/2)*G),F=["M",C,B,"L",y,I,"A",i,i,0,+(Math.abs(A-E)>180),1,p,H,"z"];F.middle={x:D,y:z};return F}for(var u=0;u<v;u++){x+=b[u];b[u]={value:b[u],order:u,valueOf:function(){return this.value}}}for(var u=0;u<v;u++){var e=w-360*b[u]/x/2;if(!u){w=90-e;e=w-360*b[u]/x/2}if(k.init){var g=s(d,c,1,w,w-360*b[u]/x).join(",")}var q=s(d,c,n,w,w-=360*b[u]/x);var o=this.path(k.init?g:q).attr({fill:k.colors&&k.colors[u]||this.g.colors[u]||"#666",stroke:k.stroke||"#fff","stroke-width":(k.strokewidth==null?1:k.strokewidth),"stroke-linejoin":"round"});o.value=b[u];o.middle=q.middle;o.mangle=e;l.push(o);h.push(o);k.init&&o.animate({path:q.join(",")},(+k.init-1)||1000,">")}for(var u=0;u<v;u++){var o=j.path(l[u].attr("path")).attr(this.g.shim);k.href&&k.href[u]&&o.attr({href:k.href[u]});o.attr=function(){};f.push(o);h.push(o)}}m.hover=function(z,r){r=r||function(){};var y=this;for(var p=0;p<v;p++){(function(A,B,i){var C={sector:A,cover:B,cx:d,cy:c,mx:A.middle.x,my:A.middle.y,mangle:A.mangle,r:n,value:b[i],total:x,label:y.labels&&y.labels[i]};B.mouseover(function(){z.call(C)}).mouseout(function(){r.call(C)})})(h[p],f[p],p)}return this};m.each=function(y){var r=this;for(var p=0;p<v;p++){(function(z,A,i){var B={sector:z,cover:A,cx:d,cy:c,x:z.middle.x,y:z.middle.y,mangle:z.mangle,r:n,value:b[i],total:x,label:r.labels&&r.labels[i]};y.call(B)})(h[p],f[p],p)}return this};m.click=function(y){var r=this;for(var p=0;p<v;p++){(function(z,A,i){var B={sector:z,cover:A,cx:d,cy:c,mx:z.middle.x,my:z.middle.y,mangle:z.mangle,r:n,value:b[i],total:x,label:r.labels&&r.labels[i]};A.click(function(){y.call(B)})})(h[p],f[p],p)}return this};m.inject=function(i){i.insertBefore(f[0])};var a=function(E,z,r,p){var I=d+n+n/5,H=c,D=H+10;E=E||[];p=(p&&p.toLowerCase&&p.toLowerCase())||"east";r=j.g.markers[r&&r.toLowerCase()]||"disc";m.labels=j.set();for(var C=0;C<v;C++){var J=h[C].attr("fill"),A=b[C].order,B;E[A]=j.g.labelise(E[A],b[C],x);m.labels.push(j.set());m.labels[C].push(j.g[r](I+5,D,5).attr({fill:J,stroke:"none"}));m.labels[C].push(B=j.text(I+20,D,E[A]||b[A]).attr(j.g.txtattr).attr({fill:k.legendcolor||"#000","text-anchor":"start"}));f[C].label=m.labels[C];D+=B.getBBox().height*1.2}var F=m.labels.getBBox(),G={east:[0,-F.height/2],west:[-F.width-2*n-20,-F.height/2],north:[-n-F.width/2,-n-F.height-10],south:[-n-F.width/2,n+10]}[p];m.labels.translate.apply(m.labels,G);m.push(m.labels)};if(k.legend){a(k.legend,k.legendothers,k.legendmark,k.legendpos)}m.push(h,f);m.series=h;m.covers=f;return m};